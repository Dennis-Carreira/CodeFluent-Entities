//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:[%=System.Environment.Version%]
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using Syncfusion.Windows.Shared;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Interactivity;
using System.Windows.Media.Animation;
using System.Windows.Threading;
using ContactManager.WPFSyncfusion;
using ContactManager.WPFSyncfusion.Models;

namespace ContactManager.WPFSyncfusion.Runtime
{
    public class TileLoadedAction : TargetedTriggerAction<UserControl>
    {
        private DispatcherTimer tiletimer;
        protected override void Invoke(object parameter)
        {
            ApplicationTile tile = ((TileView)TargetObject).DataContext as ApplicationTile;
            if (tile != null && tiletimer != null)
            {
                if (tile.CanSlide)
                {
                    tiletimer.Start();
                    tiletimer.Tick += new EventHandler(tiletimer_Tick);
                }
            }
        }

        private bool slide = false;
        Random rndm = new Random();

        private TileViewItem tileItems;

        public TileViewItem TileItems
        {
            get
            {
                if (tileItems == null)
                {
                    tileItems = VisualUtils.FindAncestor(this.Target, typeof(TileViewItem)) as TileViewItem;
                }
                return tileItems;
            }
        }

        void tiletimer_Tick(object sender, EventArgs e)
        {

            if (TileItems != null && TileItems.TileViewItemState == TileViewItemState.Normal)
            {
                Storyboard storyboard = null;
                if (!slide)
                {
                    storyboard = Application.Current.Resources["Storyboard1"] as Storyboard;
                    slide = true;
                }
                else
                {
                    storyboard = Application.Current.Resources["Storyboard2"] as Storyboard;
                    slide = false;
                }
                try
                {
                    storyboard.Begin();
                }
                catch (Exception)
                {

                }
                tiletimer.Interval = new TimeSpan(0, 0, rndm.Next(3, 10));
            }
        }

    }
}
